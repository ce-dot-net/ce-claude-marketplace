# v3.3.2 Migration Status

**Date**: 2025-11-01
**Breaking Changes**: Configuration architecture redesign

## ✅ Completed

### Plugin Implementation
- [x] **MCP Client Implementation Guide** (`docs/MCP_CLIENT_IMPLEMENTATION.md`)
  - Complete specification for v3.3.2 MCP client
  - Configuration discovery (global + project)
  - Version checking (plugin + CLAUDE.md)
  - Migration logic from v3.3.1

- [x] **MCP Team Summary** (`docs/MCP_TEAM_SUMMARY.md`)
  - Quick reference for MCP client team
  - Implementation checklist
  - API changes overview

- [x] **ace-configure Command** (`commands/ace-configure.md`)
  - Completely rewritten for dual-config architecture
  - Interactive forms with existing value display
  - Merge logic (doesn't overwrite)
  - Support for `--global` and `--project` scopes

- [x] **File Cleanup**
  - Removed `.mcp.json` from plugin directory
  - Defined new architecture (global + project)

### Configuration Schema (v3.3.2)

**Global Config**: `~/.ace/config.json`
```json
{
  "serverUrl": "https://ace-api.code-engine.app",
  "apiToken": "ace_xxxxx",
  "cacheTtlMinutes": 360,
  "autoUpdateEnabled": true
}
```

**Project Config**: `.claude/settings.local.json`
```json
{
  "mcpServers": {
    "ace-pattern-learning": {
      "command": "npx",
      "args": [
        "--yes",
        "@ce-dot-net/ace-client@3.3.2",
        "--project-id",
        "prj_xxxxx"
      ]
    }
  }
}
```

## ⚠️ Pending Updates

### High Priority - User-Facing Documentation

#### 1. **README.md** (CRITICAL)
**Status**: ❌ Not updated
**Issues Found**:
- Line 66: Still shows `<project-root>/.ace/config.json`
- Lines 82-88: Manual config shows old project-scoped structure
- Line 514: Config section mentions wrong location
- Lines 541, 548, 557, 560: References to `.mcp.json`
- Lines 578, 590, 615: Old config file references
- Line 688: Troubleshooting mentions old config path

**What Needs Changing**:
- [ ] Update "Quick Start" section to explain dual-config architecture
- [ ] Update manual configuration to show both global + project configs
- [ ] Replace all `.ace/config.json` (project) → `~/.ace/config.json` (global) + `.claude/settings.local.json` (project)
- [ ] Replace all `.mcp.json` → `.claude/settings.local.json`
- [ ] Update MCP server section to explain new discovery mechanism
- [ ] Update troubleshooting section with new file paths

#### 2. **docs/guides/INSTALL.md**
**Status**: ❌ Not updated
**Issues Found**:
- References to `<project-root>/.ace/config.json`
- States "ACE is project-scoped - there is no global ~/.ace/config.json" (now FALSE)
- Manual config creation uses old structure

**What Needs Changing**:
- [ ] Update installation steps to create global config first
- [ ] Add project config setup (`.claude/settings.local.json`)
- [ ] Fix "no global config" statement (now we DO have global config)
- [ ] Update all config examples

#### 3. **commands/ace-test.md**
**Status**: ❌ Not updated
**Issues Found**:
- Line 79, 95, 96, 103, 127: References to `<project-root>/.ace/config.json`
- Error messages mention wrong file paths

**What Needs Changing**:
- [ ] Update all config file references to `~/.ace/config.json`
- [ ] Update error messages and fallback suggestions
- [ ] Update example output to show both config files

#### 4. **CLAUDE.md** (Plugin Instructions Template)
**Status**: ❌ Not updated
**Issues Found**:
- Line 402: File structure shows `.mcp.json`

**What Needs Changing**:
- [ ] Update file structure section
- [ ] Remove `.mcp.json` reference
- [ ] Bump version from v3.3.1 → v3.3.2

#### 5. **docs/technical/ARCHITECTURE.md**
**Status**: ❌ Not updated
**Issues Found**:
- References to `.mcp.json` in file structure

**What Needs Changing**:
- [ ] Update architecture diagrams
- [ ] Update file structure section
- [ ] Document new config discovery flow

### Medium Priority - Historical Documentation

#### 6. **CHANGELOG.md**
**Status**: ⚠️ Needs v3.3.2 entry
**What Needs Adding**:
- [ ] Add v3.3.2 release notes
- [ ] Document breaking changes (config file locations)
- [ ] Document migration path from v3.3.1

### Low Priority - Reference Documentation

#### 7. **docs/releases/RELEASE_NOTES_v3.2.md**
**Status**: ⚠️ Has outdated `.mcp.json` references (OK for historical accuracy)
**Action**: Leave as-is (historical document)

---

## Migration Checklist for Plugin Release

Before releasing v3.3.2, ensure:

### Code & Files
- [x] `.mcp.json` removed from plugin directory
- [x] New commands documentation complete (`ace-configure.md`)
- [x] MCP client implementation guide created
- [ ] README.md updated
- [ ] INSTALL.md updated
- [ ] CLAUDE.md template updated (version bump)
- [ ] CHANGELOG.md has v3.3.2 entry

### Testing
- [ ] Test `/ace-orchestration:ace-configure --global`
- [ ] Test `/ace-orchestration:ace-configure --project`
- [ ] Test migration from v3.3.1 config
- [ ] Verify `.claude/settings.local.json` creation
- [ ] Verify `~/.ace/config.json` creation
- [ ] Test with fresh installation (no existing config)
- [ ] Test with existing v3.3.1 installation

### MCP Client Coordination
- [ ] MCP client team has implementation guide
- [ ] MCP client v3.3.2 implements new config discovery
- [ ] MCP client v3.3.2 implements version checking
- [ ] MCP client v3.3.2 implements migration logic
- [ ] MCP client v3.3.2 published to npm

### Documentation
- [ ] User migration guide created
- [ ] Breaking changes clearly documented
- [ ] Troubleshooting section updated
- [ ] All config file paths corrected

---

## Breaking Changes Summary

**For Users**:
1. **Config Location Changed**:
   - Old: `.ace/config.json` in project root
   - New: `~/.ace/config.json` (global) + `.claude/settings.local.json` (project)

2. **MCP Server Definition**:
   - Old: `.mcp.json` in plugin directory
   - New: `.claude/settings.local.json` in project root

3. **Migration**:
   - Automatic on first run of MCP client v3.3.2
   - Old config files migrated to new locations
   - Manual migration instructions available

**For MCP Client**:
1. **Config Discovery**: Must read two files instead of one
2. **Version Checking**: Must check GitHub for updates
3. **Initialization**: Must return version status
4. **Cache TTL**: Default changed from 5 min → 360 min

---

## Next Steps

### Immediate (Plugin Team):
1. Update README.md with new config architecture
2. Update INSTALL.md with new setup process
3. Update ace-test.md error messages
4. Update CLAUDE.md template (version bump to v3.3.2)
5. Add v3.3.2 entry to CHANGELOG.md
6. Create user migration guide

### Coordination (MCP Client Team):
1. Implement v3.3.2 per `docs/MCP_CLIENT_IMPLEMENTATION.md`
2. Test all scenarios from implementation guide
3. Publish v3.3.2 to npm

### Release:
1. Coordinate plugin v3.3.2 release with MCP client v3.3.2 release
2. Both must be released together (breaking changes)
3. Update marketplace listing with migration guide link

---

## Estimated Work Remaining

**Plugin Documentation**: ~2-3 hours
- README.md: ~45 min (multiple sections to update)
- INSTALL.md: ~30 min
- ace-test.md: ~20 min
- CLAUDE.md: ~10 min (version bump + file structure)
- ARCHITECTURE.md: ~20 min
- CHANGELOG.md: ~15 min
- Migration guide: ~30 min

**MCP Client Implementation**: ~4-6 hours (MCP team)
- Config discovery: ~1 hour
- Version checking: ~2 hours
- Migration logic: ~1 hour
- Testing: ~2 hours

**Total**: ~6-9 hours combined effort
